---
phase: 03-advanced-calibration-&-int4
task: planning
total_tasks: 3
status: not_started
last_updated: 2026-02-03T19:45:00Z
---

<current_state>
User invoked `/gsd:plan-phase 3` but interrupted the process with `/gsd:pause-work`.

**Exact state:** Orchestrator was about to begin Phase 3 planning workflow:
- Phase validated successfully (Phase 3: Advanced Calibration & INT4)
- Model profile resolved: "quality" (researcher: opus, planner: opus, checker: sonnet)
- Phase 3 directory does not exist yet (needs creation)
- No CONTEXT.md exists for Phase 3 (would need `/gsd:discuss-phase 3` or skip discussion)
- No RESEARCH.md exists for Phase 3

**What happens next when resuming:**
The `/gsd:plan-phase 3` command should continue from step 5 (Handle Research) of the planning workflow. Since no research or context exists, it will likely need to spawn the researcher agent first to investigate:
- INT4 quantization with group-wise scaling
- Advanced observers (MovingAverageMinMax, Histogram)
- Layer skipping and accuracy warnings
</current_state>

<completed_work>

**Phase 2: Static Quantization & I/O — COMPLETE ✓**
All 4 plans executed successfully across 3 waves:

- **02-01** (7 min): Calibration infrastructure with MinMaxObserver, run_calibration, DataLoader/tensor support
- **02-02** (11 min): Layer selection API, static_quantize with calibration, dequantize_model (includes auto-fix for zero-point clamping)
- **02-03** (5 min): Serialization formats (PyTorch + Safetensors) with comprehensive metadata
- **04-04** (7 min): Validation metrics and public API integration

**Verification:** 6/6 must-haves verified (100%)
- All success criteria met
- All 12 requirements satisfied
- 2,262 lines of implementation across 6 key files
- No stub patterns found

**Commits:**
- 98c1ea1 through 8bea986 (02-01 tasks)
- 3d32e0e through 7bd6f48 (02-02 tasks and fix)
- 28c9d49 through f3b61b2 (02-03 tasks)
- 8976cb4 through 813b995 (02-04 tasks)
- ccd393e (orchestrator corrections)
- 6842048 (phase completion)

**Dependencies added:**
- safetensors>=0.4 (runtime)
- tqdm>=4.66 (dev)
</completed_work>

<remaining_work>

**Phase 3: Advanced Calibration & INT4** — NOT STARTED

From ROADMAP.md:
- Goal: Users can apply INT4 quantization with advanced observers and layer skipping
- Depends on: Phase 2 (complete)
- Requirements: CAL-02, CAL-03, CAL-04, QCORE-02, VAL-04
- Success Criteria:
  1. User can quantize a model to INT4 with group-wise scaling
  2. User can choose MovingAverageMinMaxObserver or Histogram observer for robust calibration
  3. User can skip sensitive layers during quantization (e.g., embeddings, layer norm)
  4. System warns about potential accuracy issues when aggressive quantization is applied
- Plans: 3 plans
  - 03-01: INT4 quantization with group-wise scaling
  - 03-02: Advanced observers (MovingAverageMinMax, Histogram)
  - 03-03: Layer skipping and accuracy warnings

**No plans created yet.** Phase 3 needs:
1. Context gathering (optional but recommended via `/gsd:discuss-phase 3`)
2. Research (gsd-phase-researcher)
3. Planning (gsd-planner)
4. Verification (gsd-plan-checker)
</remaining_work>

<decisions_made>

**From Phase 2:**
- Custom MinMaxObserver to avoid deprecated torch.ao.quantization APIs
- 150 calibration samples default (100-200 research baseline)
- Progress bar threshold at 50 samples
- Layer selection with both include/exclude and type/name approaches
- Safetensors metadata as JSON strings (format constraint)
- Always validate with 4 checks (SQNR, size, load test, weight range)
- Validation failure behavior configurable via on_failure

**These inform Phase 3:**
- Group-wise scaling for INT4 will need to follow similar patterns (avoid deprecated APIs)
- Advanced observers (MovingAverageMinMax, Histogram) should integrate with existing calibration infrastructure
- Layer skipping should work with existing layer selection framework
</decisions_made>

<blockers>

None. Phase 2 completed cleanly with verification passed. Ready to begin Phase 3.
</blockers>

<context>

**Project state:**
- Mono Quant is an ultra-lightweight PyTorch quantization package
- Focus: Simple, reliable quantization with minimal dependencies (just torch)
- Target users: ML engineers needing quantization without ecosystem baggage
- Current progress: 50% complete (Phase 1 done, Phase 2 done, Phases 3-4 remaining)

**Technical context for Phase 3:**
- Quantization infrastructure exists (schemes, mappers, observers, quantizers)
- Calibration pipeline works (MinMaxObserver, run_calibration, data normalization)
- Layer selection framework supports type-based and name-based filtering
- Serialization formats support both PyTorch and Safetensors with metadata
- Validation system provides SQNR, size metrics, and load testing

**Phase 3 will add:**
1. INT4 quantization with group-wise scaling (more aggressive compression)
2. Advanced observers for robust calibration (MovingAverageMinMax, Histogram)
3. Layer skipping to protect sensitive layers (embeddings, layer norm)
4. Accuracy warnings when aggressive quantization is applied

**Research will need to investigate:**
- Group-wise scaling patterns for INT4 quantization
- MovingAverageMinMax observer implementation patterns
- Histogram observer implementation patterns
- How to detect sensitive layers that should be skipped
- Accuracy metrics for quantization quality assessment
</context>

<next_action>

When resuming, user has two options:

**Option 1 (Recommended): Continue planning Phase 3**
- Run `/gsd:plan-phase 3` again
- Orchestrator will detect phase has no directory/research/context
- Will guide through: discuss-phase (optional) → research → plan → verify

**Option 2: Skip discussion, go straight to planning**
- Run `/gsd:plan-phase 3 --skip-research`
- Spawns planner immediately (but may miss important context gathering)

**Recommended first action:**
- Consider running `/gsd:discuss-phase 3` first to gather implementation decisions
- This is especially valuable for Phase 3 which involves complex new features (INT4, advanced observers, layer skipping)
</next_action>
